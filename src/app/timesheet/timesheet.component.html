<!-- <div class="tabs">
  <a routerLink="/timesheet" routerLinkActive="active-tab" class="tab-link">
    <i class="pi pi-table"></i> My Timesheet
  </a>
  <a routerLink="/submitted" routerLinkActive="active-tab" class="tab-link">
    <i class="pi pi-check-square"></i> Submitted Timesheet
  </a>
</div> -->
<!-- <div class="timesheet-toolbar"> -->
  <!-- View Options -->
  <!-- <div class="view-toggle">
  <p-buttonGroup>
    <p-button label="Month" class="p-button-sm p-button-text"></p-button>
    <p-button label="Week" class="p-button-sm p-button-outlined"></p-button>
  </p-buttonGroup>m p-button-text"></p-button>
    <p-button label="Day" class="p-button-s
</div> -->
  <!-- <div class="view-control">
  <div class="view-tab">
    <button class="nav-btn"><i class="pi pi-calendar"> month</i></button>
    <button class="nav-btn"><i class="pi pi-calendar"> month</i></button>
    <button class="nav-btn"><i class="pi pi-calendar"> month</i></button>
  </div>
  </div>
</div> -->

  <!-- <div class="btn-group btn-group-sm" role="group">
    <button type="button" class="btn btn-outline-secondary">Month</button>
    <button type="button" class="btn btn-outline-danger active">Week</button>
    <button type="button" class="btn btn-outline-secondary">Day</button>
  </div>

  Date Navigation -->
<!-- <div class="date-navigation">
  <button pButton icon="pi pi-angle-left" class="p-button-text p-button-sm"></button>
  <span class="date-range">Jun 16, 2025 - Jun 22, 2025</span>
 
</div> -->


  <!-- Summary + Submit -->
  <!-- <div class="summary-submit">
    <span class="logged">00:00 hrs</span>
    <small>Logged Hours</small>
    <span class="submitted ml-3">00:00 hrs</span>
    <small>Submitted Hours</small>
    <p-splitButton label="Submit" [model]="submitOptions" class="ml-3"
      styleClass="p-button-sm p-button-primary"></p-splitButton>
  </div>


</div> -->
  <!-- <div class="p-m-4">
<nav class="main-nav">
  <a routerLink="/timesheet" routerLinkActive="active-link">
    <i class="pi pi-clock"></i>
    Timesheet
  </a>
  <a routerLink="/reports" routerLinkActive="active-link">
    <i class="pi pi-chart-bar"></i>
    Reports
  </a>
</nav>
  <p-table [value]="projects" dataKey="id" expandableRows>
    <ng-template pTemplate="header">
      <tr>
        <th>Project</th>
        <th>Description</th>
        <th>Billable</th>
        <th *ngFor="let day of days">{{ day }}</th>
        <th>Add Task</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-project>
      <tr>
        <td [attr.rowspan]="filterTasks(project.tasks).length + 1">{{ project.name }}</td>
      </tr>
      <ng-container *ngFor="let task of filterTasks(project.tasks)">
        <tr>
          <td>
            <input pInputText [(ngModel)]="task.description" (ngModelChange)="save()" placeholder="Task description">
          </td>
          <td>
            <p-toggleButton [(ngModel)]="task.billable" onLabel="Yes" offLabel="No" (onChange)="toggleBillable(task)"></p-toggleButton>
          </td>
          <td *ngFor="let day of days">
            <input type="number" pInputText [(ngModel)]="task.hours[day]" min="0" (ngModelChange)="onHourChange()" style="width: 60px;">
          </td>
          <td>
            <button pButton icon="pi pi-plus" (click)="addTask(project)" class="p-button-sm"></button>
          </td>
        </tr>
      </ng-container>
    </ng-template>
  </p-table>

  <div class="p-mt-3">
    <strong>Total Hours: {{ totalHours }}</strong>
    <button pButton label="Submit" class="p-ml-3" (click)="submit()"></button>
  </div>
</div> -->
 
<div class="tab-navigation">
    <div class="tab active">
      <i class="pi pi-calendar"></i>
      <span>My Timesheet</span>
    </div>
    <div class="tab">
      <i class="pi pi-check-square"></i>
      <span>Submitted Timesheet</span>
    </div>
  </div>
 

  <div class="view-controls">
    <div class="view-tabs">
      <p-button class="view-tab">Month</p-button>
      <p-button class="view-tab active">Week</p-button>
      <p-button class="view-tab ">Day</p-button>
    </div>
    <div class="date-navigation">
      <button class="nav-btn" (click)="prevWeek()">
    <i class="pi pi-chevron-left"></i>
  </button>
     <button class="nav-btn" (click)="nextWeek()">
    <i class="pi pi-chevron-right"></i>
  </button>
   <span class="date-range">
    {{ weekStart | date:'MMM d, y' }} - {{ weekEnd | date:'MMM d, y' }}
  </span>
      <button class="calendar-btn"><i class="pi pi-calendar-times"></i></button>
    </div>
     <div class="hour-summary">
      <div class="logged-hours">
        <span class="hour-value">00:00 hrs</span>
        <span class="hour-label">Logged Hours</span>
      </div>
      <div class="submitted-hours">
        <span class="hour-value">00:00 hrs</span>
        <span class="hour-label">Submitted Hours</span>
      </div>
      <div class="action-buttons">
        <p-button class="project-btn" icon="pi pi-plus" label="Project"   (click)="openModal()"/>
        <p-button label="Submit" class="submit-btn" [raised]="true" severity="info"/>
        <p-button class="options-btn"><i class="pi pi-chevron-down"></i></p-button >
      </div>
    </div>      
  </div>  
 

   <p-table
  [value]="projects"
  dataKey="name"
  rowGroupMode="subheader"
  groupRowsBy="name"
  sortField="name"
  sortMode="single"
 
>
  <!-- HEADER -->
<ng-template #header>
  <tr>
    <th style="width: 20%">Projects / Tasks</th>
    <th style="width: 20%">Description</th>
    <th style="width: 10%">Billability</th>
    <th *ngFor="let day of weekDays">
      {{ day.label }} <br />
      <span class="header-date">{{ day.date }}</span>
    </th>
    <th>Total</th>
  </tr>
</ng-template>

  <!-- GROUP HEADER: Project Row With + Task and Time Columns -->
  <ng-template #groupheader let-project let-expanded="expanded">
    <tr>
      <!-- Main Project Cell -->
      <td class="align-middle">
        <div class="flex items-center">
          <button
            type="button"
            pButton
            pRipple
            [pRowToggler]="project"
            text
            rounded
            plain
            class="mr-2"
            [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"
          ></button>

          <!-- <img
            src="https://primefaces.org/cdn/primeng/images/demo/avatar/avatar1.png"
            width="24"
            height="24"
            class="mr-2"
          /> -->

           <img src="assets/project.png" alt="project" class="project-img"  width="24"
            height="24"
            class="mr-2" />
          <span class="font-bold mr-3">{{ project.name }}</span>

          <!-- '+ Task' beside project name (only before expand) -->
          <a *ngIf="!expanded" href="#"  (click)="openTask(project)">+ Task</a>
        </div>
      </td>

      <!-- Placeholder for description -->
      <td></td>
      <!-- Placeholder for billable -->
      <td></td>

      <!-- Hours columns: shown only when not expanded -->
<!-- Hours columns: visible only when not expanded -->
<ng-container *ngIf="!expanded">
  <td *ngFor="let day of weekDays">
    {{ formatHour(getProjectDayTotal(project, day.label)) }}
  </td>
</ng-container>

<!-- Empty tds to preserve row structure when expanded -->
<ng-container *ngIf="expanded">
  <td colspan="7"></td>
</ng-container>


    </tr>
  </ng-template>

  <!-- EXPANDED ROW -->
 <!-- EXPANDED ROW -->
<ng-template #expandedrow let-project>
  <ng-container *ngFor="let task of project.tasks">
    <tr>
      <!-- Editable Task Name -->
      <td>
        {{ task.name }}
      </td>
      <!-- Editable Description -->
      <td>
        {{ task.description }}
      </td>
      <!-- Billable Toggle -->
      <td>
      <span
    class="billable-pill"
    [ngClass]="task.billable ? 'billable' : 'non-billable'"
    (click)="task.billable = !task.billable; save()"
    style="cursor:pointer;"
  >
    {{ task.billable ? 'Billable' : 'Non-Billable' }}
  </span>
      </td>
      <!-- Editable Hour Inputs for Each Day -->
         <td *ngFor="let day of weekDays">
  <ng-container *ngIf="editRow === task && editCol === day.label; else displayHour">
    <input
      type="number"
      min="0"
      max="24"
      step="0.25"
      [(ngModel)]="task.hours[day.label]"
     (ngModelChange)="onHourChange(project.id, project.tasks)"
      style="width: 60px; text-align: center; appearance: textfield;"
      (blur)="editRow = null; editCol = null"
      autofocus
    />
  </ng-container>
  <ng-template #displayHour>
    <span style="cursor:pointer;" (click)="editRow = task; editCol = day.label">
      {{ formatHour(task.hours[day.label]) }}
    </span>
  </ng-template>
</td>
      <!-- Total Hours for Task -->
      <td style="font-weight:600; color:#1976d2;">
        {{ formatHour(getTaskTotal(task)) }}
      </td>
    </tr>
  </ng-container>
  <!-- Add Task Row -->
  <tr>
    <td colspan="11">
      <a href="#" (click)="openTask(project)">+ Task</a>
    </td>
  </tr>
</ng-template>
<!-- FINAL TOTAL ROW at the end of table -->
 <ng-template #footer>
    <tr class="p-rowgroup-footer" style="background-color: #f4fbff">
      <td colspan="3" style="text-align: right; font-weight: bold; color: #0d6efd">Total</td>
      <!-- CHANGED: use day.label instead of day -->
      <td *ngFor="let day of weekDays" style="color: #0d6efd">
  {{ formatHour(getDayTotal(day.label)) }}
</td>
<td style="color: #0d6efd; font-weight: bold;">
  {{ formatHour(getGrandTotal()) }}
</td>
    </tr>
  </ng-template>
</p-table>
